<!doctype html>

<html class="no-js" lang="en">
  <head>
	  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
	       👋, I'm Pericles Theodorou.

	       Simples Theme by https://jekyllthemes.io
	       Premium + free Jekyll themes for your blog or website.

	     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	  <meta charset="utf-8">
	  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	  <!-- Page Info -->
	  <link rel="shortcut icon" href="/images/favicon.png">
	  <title>
      
        Pointer misuse in Go – 👋, I'm Pericles Theodorou.
      
    </title>
	  <meta name="description" content="Looking at some of the ways pointers get misused in Go and how we can improve them.">

	  <!-- Twitter Card -->
	  <meta name="twitter:card" content="summary_large_image">
	  <meta name="twitter:title" content="Pointer misuse in Go – 👋, I'm Pericles Theodorou.">
	  <meta name="twitter:description" content="Looking at some of the ways pointers get misused in Go and how we can improve them.">
	  <meta name="twitter:image:src" content="http://localhost:4000/images/go-pointers/featured.png">

	  <!-- Facebook OpenGraph -->
	  <meta property="og:title" content="Pointer misuse in Go – 👋, I'm Pericles Theodorou." />
	  <meta property="og:description" content="Looking at some of the ways pointers get misused in Go and how we can improve them." />
	  <meta property="og:image" content="http://localhost:4000/images/go-pointers/featured.png" />

	  
	  <!-- Font Embed Code -->
	  <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600" rel="stylesheet">
	  

	  <!-- Styles -->
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  <link rel="stylesheet" href="/css/style.css">

	  <!-- Icons -->
	  <script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	  <script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	  <script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	  
	  <!-- Custom Styles -->
	  <style></style>
	  

	  
  	<!-- Analytics Code -->
	  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39385037-2"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', "UA-39385037-2");
</script>

	  

	  
	  <!-- Extra Header JS Code -->
	  
	  
  </head>

  <body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/blog/pointer-misuse-in-go">

	  <header class="header">

	<div class="wrap">

		
		<a href="/" class="header__avatar">
			<img src="/images/avatar.jpg" class="header__avatar__img">
		</a>
		

		
		<a href="/" class="header__title">
			👋, I'm Pericles Theodorou.
		</a>
		

		<p class="header__tagline">I share my passion for technology and products. CTO <a href="https://creditdigital.co.uk" target="_blank">@creditdigital</a>.</p>

		<div class="menu">
			<ul class="menu__list">
				
				<li class="menu__list__item">
					<a href="/" class="menu__list__item__link">Latest</a>
				</li>
				
				<li class="menu__list__item">
					<a href="/about" class="menu__list__item__link">About</a>
				</li>
				
			</ul>
		</div>

	</div>

</header>


	  <div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	  <div class="page-loader"></div>
	  <div class="page">
		  <div class="page__content" data-page-title="Pointer misuse in Go – 👋, I'm Pericles Theodorou." data-image="/images/go-pointers/featured.png">
			  <section class="single">

	<div class="wrap">

		<h1>Pointer misuse in Go</h1>
		<p class="subtitle">01 April 2019</p>

		<p><img src="/images/go-pointers/featured.png" alt="Photo by Ashley @ https://github.com/ashleymcnamara/gophers" /></p>

<p>Pointers are a great way of building software in a more efficient and less memory intensive fashion. I find however, there is a great source of confusion and misuse around their application that lead to less intuitive and often bug prone programs.</p>

<p>Let’s see a typical usage of pointers:</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    	</span><span class="s">"fmt"</span><span class="x">
    </span><span class="p">)</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">Human</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Name</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Human</span><span class="p">{</span><span class="s">"JeSsie"</span><span class="p">}</span><span class="x">
    	</span><span class="n">transformName</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="x">
    	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x"> </span><span class="c">// returns 'JESSIE'</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// transformName will uppercase the name of a human</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">transformName</span><span class="p">(</span><span class="n">h</span><span class="x"> </span><span class="o">*</span><span class="n">Human</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">b</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="x"> </span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span><span class="x">
    
    	</span><span class="k">for</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">b</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="n">c</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x">
    		</span><span class="k">if</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&amp;&amp;</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="sc">'z'</span><span class="x"> </span><span class="p">{</span><span class="x">
    			</span><span class="n">c</span><span class="x"> </span><span class="o">-=</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">-</span><span class="x"> </span><span class="sc">'A'</span><span class="x">
    		</span><span class="p">}</span><span class="x">
    		</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">c</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    
    	</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>So, what’s the issue with the above code anw?</p>

<h3 id="mutation-is-sneaky-at-best">Mutation is sneaky at best</h3>
<p>Mutation is difficult to tackle when things go wrong. A million things could have altered the state of your program. Now, it’s not to say mutation is necessarily bad but in a lot of cases we can improve its visibility. For instance, instead of having <code class="highlighter-rouge">transformName</code> doing the mutation, have it return a <code class="highlighter-rouge">string</code>. This will force the propagation of the mutation to happen at a more visible place.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Human</span><span class="p">{</span><span class="s">"JeSsie"</span><span class="p">}</span><span class="x">
    	</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">transformName</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="x">
    	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x"> </span><span class="c">// returns 'JESSIE'</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>The above though doesn’t really feel idiomatic Go. Moreover, there is a better way of achieving a similar effect to the above.</p>

<h3 id="use-methods-when-it-comes-to-mutations">Use methods when it comes to mutations</h3>
<p>Methods are just functions that have a particular receiver. Attaching behaviour that is operating specifically on a type is the perfect usecase. It also makes code much cleaner.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Human</span><span class="p">{</span><span class="s">"JeSsie"</span><span class="p">}</span><span class="x">
    	</span><span class="n">h</span><span class="o">.</span><span class="n">transformName</span><span class="p">()</span><span class="x">
    	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// transformName will upper case the name of a human</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">h</span><span class="x"> </span><span class="o">*</span><span class="n">Human</span><span class="p">)</span><span class="x"> </span><span class="n">transformName</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">b</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="x"> </span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span><span class="x">
    
    	</span><span class="k">for</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">b</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="n">c</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x">
    		</span><span class="k">if</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&amp;&amp;</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="sc">'z'</span><span class="x"> </span><span class="p">{</span><span class="x">
    			</span><span class="n">c</span><span class="x"> </span><span class="o">-=</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">-</span><span class="x"> </span><span class="sc">'A'</span><span class="x">
    		</span><span class="p">}</span><span class="x">
    		</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">c</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    
    	</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>The above has also the positive side-effect that by scanning the methods of a type, you can see where the mutation happens instead of having to pass pointers around in your application.</p>

<h3 id="the-function-signature-should-be-succint-and-to-the-point">The function signature should be succint and to the point</h3>
<p>Type driven development is a way of developing software specifically in pure functional languages like Haskell and Elm. When reading the type signature of a function it should be very clear to the reader what this function will do. Let’s have a look at the signature of <code class="highlighter-rouge">transformName</code></p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">func</span><span class="x"> </span><span class="n">transformName</span><span class="p">(</span><span class="n">h</span><span class="x"> </span><span class="o">*</span><span class="n">Human</span><span class="p">)</span><span class="x"> </span><span class="p">{}</span></code></pre></figure>

<p>Hm.. So it takes a pointer to a <code class="highlighter-rouge">Human</code> and returns nothing. There are a lot of questions that are raised based on this signature. Why does it take a whole <code class="highlighter-rouge">Human</code> to operate just on its name? 🤔 Is there a possibility that it could also operate on its surname? Does it have different rules based on the <code class="highlighter-rouge">Human</code>’s locale?</p>

<p>Let’s look at the solutions we mention above.</p>

<p>In the case of the function that returns just a string, the type signature is simply</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">func</span><span class="x"> </span><span class="n">transformName</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{}</span></code></pre></figure>

<p>Nice! It’s very clear to the reader that this function receives a string and returns a string. 🆒</p>

<p>What about the method? Well that’s an interesting one. On the surface, it’s no better than the initial implementation. I beg to disagree though. By hiding the internal implementation and attaching it to the <code class="highlighter-rouge">Human</code> type, we have now given full control of details to the struct itself.</p>

<h3 id="aim-to-make-functions-as-pure-as-possible">Aim to make functions as “pure” as possible</h3>
<p>Purity is a term you normally associate with Haskell but that doesn’t mean we cannot make use of it in Go as well. Functions without side-effects makes refactoring so much easier. Let’s say we are staring at the initial solution fresh. Practically, that function takes a string and uppercases it. So why does it need to be associated with a <code class="highlighter-rouge">Human</code> and it’s <code class="highlighter-rouge">Name</code>? It sounds like it could live under the <code class="highlighter-rouge">string</code> package. <a href="https://golang.org/pkg/strings/#ToUpper">Indeed such function does exist!</a> But let’s assume that it didn’t exist. What would our code look like.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    	</span><span class="s">"fmt"</span><span class="x">
    </span><span class="p">)</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">Human</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Name</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Human</span><span class="p">{</span><span class="s">"JeSsie"</span><span class="p">}</span><span class="x">
    	</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">uppercaseString</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x">
    	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// uppercaseString will return a new uppercased string</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">uppercaseString</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">b</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="x"> </span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span><span class="x">
    
    	</span><span class="k">for</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">b</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="n">c</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x">
    		</span><span class="k">if</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&amp;&amp;</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="sc">'z'</span><span class="x"> </span><span class="p">{</span><span class="x">
    			</span><span class="n">c</span><span class="x"> </span><span class="o">-=</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">-</span><span class="x"> </span><span class="sc">'A'</span><span class="x">
    		</span><span class="p">}</span><span class="x">
    		</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">c</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    
    	</span><span class="k">return</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>Great. But we can make it more Go-like based on what we have discussed so far.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    	</span><span class="s">"fmt"</span><span class="x">
    </span><span class="p">)</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">Human</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Name</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Human</span><span class="p">{</span><span class="s">"JeSsie"</span><span class="p">}</span><span class="x">
    	</span><span class="n">h</span><span class="o">.</span><span class="n">transformName</span><span class="p">()</span><span class="x">
    	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">h</span><span class="x"> </span><span class="o">*</span><span class="n">Human</span><span class="p">)</span><span class="x"> </span><span class="n">transformName</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">uppercaseString</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// uppercaseString will return a new uppercased string</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">uppercaseString</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">b</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="x"> </span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span><span class="x">
    
    	</span><span class="k">for</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">b</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="n">c</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x">
    		</span><span class="k">if</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&amp;&amp;</span><span class="x"> </span><span class="n">c</span><span class="x"> </span><span class="o">&lt;=</span><span class="x"> </span><span class="sc">'z'</span><span class="x"> </span><span class="p">{</span><span class="x">
    			</span><span class="n">c</span><span class="x"> </span><span class="o">-=</span><span class="x"> </span><span class="sc">'a'</span><span class="x"> </span><span class="o">-</span><span class="x"> </span><span class="sc">'A'</span><span class="x">
    		</span><span class="p">}</span><span class="x">
    		</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">c</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    
    	</span><span class="k">return</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>Whether is worth the extra step or not is up to the programmer and the circumstances.</p>

<p>Up until this point, I mentiond that pointers are mostly an optimization strategy which is slightly misleading. In his book <a href="https://www.manning.com/books/go-in-action">Go in Action</a>, <a href="https://twitter.com/goinggodotnet">Bill Kennedy</a> goes in great detail about pointers semantics. Pointer semantics are <em>the</em> way we should think about the way we build software in Go. Performance can come later.</p>

<p>Pointer semantics allude to the idea that certain entities in your software will need to propagate any changes to the rest of the program. We see this a lot with configuration and structs that represent table data. Let’s say we have a User table and we have a <code class="highlighter-rouge">User</code> struct type. Does a change in the <code class="highlighter-rouge">User</code>’s email need to be realised by another part of the program that is operating on that entity? If this answer is yes, mostly likely you need to be using a pointer to represent that entity.</p>

<h3 id="pointers-semantics-are-not-an-excuse-for-nullable-types">Pointers semantics are not an excuse for nullable types</h3>
<p>Having a function receiving or returning a pointer, means that function can receive or return <code class="highlighter-rouge">nil</code>. I find this pattern to be code smell. Let’s look at an example.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">User</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Email</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">u</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="s">"email@icloud.com"</span><span class="p">)</span><span class="x">
    	</span><span class="k">if</span><span class="x"> </span><span class="n">u</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="nb">panic</span><span class="p">(</span><span class="s">"OMG!!"</span><span class="p">)</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// findUser performs a DB lookup and returns a User</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="o">*</span><span class="n">User</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="c">// Ooops we couldn't find a user</span><span class="x">
    	</span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>At first glance, this makes sense. However, we have used the fact that <code class="highlighter-rouge">findUser</code> returns a pointer to sneak in a <code class="highlighter-rouge">nil</code> value. This is bad in my opinion for two reasons.</p>

<h3 id="nil-sucks-">Nil sucks 🔥</h3>
<p>In languages like Ruby where types are not a thing, <code class="highlighter-rouge">nil</code> is pretty much the only way to represent the absence of a value. But with Go we can do so much better.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">User</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Email</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">u</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="s">"email@icloud.com"</span><span class="p">)</span><span class="x">
    	</span><span class="k">if</span><span class="x"> </span><span class="n">u</span><span class="o">.</span><span class="n">Email</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="s">""</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="nb">panic</span><span class="p">(</span><span class="s">"OMG!!"</span><span class="p">)</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// findUser performs a DB lookup and returns a User</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="o">*</span><span class="n">User</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="c">// Ooops we couldn't find a user</span><span class="x">
    	</span><span class="k">return</span><span class="x"> </span><span class="o">&amp;</span><span class="n">User</span><span class="p">{}</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>Yeah I said it! Just instantiate an empty <code class="highlighter-rouge">User</code> struct and utilize Go’s default values.</p>

<p>What about an even better way?</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">import</span><span class="x"> </span><span class="s">"errors"</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">User</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Email</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="s">"email@icloud.com"</span><span class="p">)</span><span class="x">
    	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="nb">panic</span><span class="p">(</span><span class="s">"OMG!!"</span><span class="p">)</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// findUser performs a DB lookup and returns a User</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="p">(</span><span class="o">*</span><span class="n">User</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="c">// Ooops we couldn't find a user</span><span class="x">
    	</span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="p">,</span><span class="x"> </span><span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"Sorry m8, couldn't find user"</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>This approach, builds on the whole idea of Go’s multiple returns with the last one being an <code class="highlighter-rouge">error</code>. Now our code is super clear. Having <code class="highlighter-rouge">findUser</code> being responsible knowning about errors also helps to customize the type of errors that we could have and have the caller act accordingly.</p>

<h3 id="imo-my-code-shouldnt-be-affected-based-on-pointer-semantics">IMO my code shouldn’t be affected based on pointer semantics</h3>
<p>Obviously working with pointers forces you to think and structure your application in a different way. I argue that it shouldn’t really matter the way we design our interactions between our functions.
Let’s flip it on it’s head a bit and see our functions as if it was returning a value instead of a pointer.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="x">    </span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">
    
    </span><span class="k">type</span><span class="x"> </span><span class="n">User</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">Email</span><span class="x"> </span><span class="kt">string</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    	</span><span class="n">u</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="s">"email@icloud.com"</span><span class="p">)</span><span class="x">
    	</span><span class="k">if</span><span class="x"> </span><span class="n">u</span><span class="o">.</span><span class="n">Email</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="s">""</span><span class="x"> </span><span class="p">{</span><span class="x">
    		</span><span class="nb">panic</span><span class="p">(</span><span class="s">"OMG!!"</span><span class="p">)</span><span class="x">
    	</span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    
    </span><span class="c">// findUser performs a DB lookup and returns a User</span><span class="x">
    </span><span class="k">func</span><span class="x"> </span><span class="n">findUser</span><span class="p">(</span><span class="n">str</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="n">User</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="c">// Ooops we couldn't find a user</span><span class="x">
    	</span><span class="k">return</span><span class="x"> </span><span class="n">User</span><span class="p">{}</span><span class="x">
    </span><span class="p">}</span></code></pre></figure>

<p>In this case we cannot just return <code class="highlighter-rouge">nil</code> which would have forced us to use one of the ways we experimented with earlier. Naturally, and given practical requirements, we would have opted in for returning an <code class="highlighter-rouge">error</code> as second argument. The convenience of being able to return <code class="highlighter-rouge">nil</code> however, clouded the way we should have looked at that piece of code in the first place.</p>

<p>To recap: pointer semantics should be the driving force when using pointers. Performance can come later. Avoid passing <code class="highlighter-rouge">nil</code> when pointers are expected.</p>



	</div>

</section>
		  </div>
	  </div>

	  <footer class="footer">

	<ul class="socials">
	
	
	
	
	<li class="socials__item">
		<a href="https://www.twitter.com/periclestheo" target="_blank" class="socials__item__link" title="Twitter">
			<i class="fab fa-twitter" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	<li class="socials__item">
		<a href="https://www.instagram.com/periclestheo" target="_blank" class="socials__item__link" title="Instagram">
			<i class="fab fa-instagram" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/periclestheo" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/periclestheo" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

	<div class="footer__copyright">
		<span>© 2019 👋, I'm Pericles Theodorou.</span>
	</div>

</footer>


	  <!-- Javascript Assets -->
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	  <script src="/js/simples-min.js"></script>

	  
	  <!-- Extra Footer JS Code -->
	  
	  
  </body>
</html>
